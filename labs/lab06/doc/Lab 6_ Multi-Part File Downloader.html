<!DOCTYPE html>
<!-- saved from url=(0038)https://py.mit.edu/spring22/labs/lab06 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This page was generated by CAT-SOOP 2022.2.0.dev19.  miau. -->

<title>Lab 6: Multi-Part File Downloader | 6.009 Spring 2022</title>
<link href="./Lab 6_ Multi-Part File Downloader_files/logo.gif" rel="icon" type="image/gif">
<!-- include catsoop base css -->
<link href="./Lab 6_ Multi-Part File Downloader_files/base.css" rel="stylesheet" type="text/css">
<!-- set up JS namespace for catsoop -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    var catsoop = {plugins: {}};

    function toggleResponsiveHeader(){
        document.getElementsByTagName('header')[0].classList.toggle('responsive');
    }

    window.addEventListener('DOMContentLoaded', function(){
        var menu_boxes = document.getElementsByClassName('dropdown-checkbox');
        for(var i=0; i<menu_boxes.length; i++){
            menu_boxes[i].checked = false;
        }
    });

    function clearMenu(menu){
       menu.children[1].checked = false;
    }
    // @license-end
    </script>
<!-- load in katex and CAT-SOOP-specific math rendering  -->
<script src="./Lab 6_ Multi-Part File Downloader_files/katex.min.js.stažený soubor" type="text/javascript"></script>
<link href="./Lab 6_ Multi-Part File Downloader_files/katex.min.css" rel="stylesheet" type="text/css">
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.katex_macros = {};
    catsoop.render_math = function (elt) {
        var tex = elt.innerText; // TeX Source
        var display = elt.classList.contains('cs_displaymath');
        try {
            katex.render(tex, elt, {displayMode: display, macros: catsoop.katex_macros});
        }catch(e) {
            console.log(e);
            elt.innerHTML = "<font color='red'><b>Could not parse math:</b> <tt>" + tex + "</tt></font>";
        }
        elt.classList.remove('cs_math_to_render');
    }


    catsoop.render_all_math = function (elt){
        var mathelts = elt.getElementsByClassName('cs_math_to_render');
        while(mathelts.length > 0){
            catsoop.render_math(mathelts[0]);
        }
    }
    document.addEventListener("DOMContentLoaded", function(event) {
          catsoop.render_all_math(document);
    });
    // @license-end
    </script>
<!-- load in diagram stuff -->
<script src="./Lab 6_ Multi-Part File Downloader_files/cs_diagrams.js.stažený soubor" type="text/javascript"></script>
<script type="text/javascript">
        catsoop.diagram_sources = {};
    </script>
<!-- Syntax Highlighting -->
<script src="./Lab 6_ Multi-Part File Downloader_files/highlight.min.js.stažený soubor" type="text/javascript"></script>
<script src="./Lab 6_ Multi-Part File Downloader_files/highlightjs-line-numbers.js.stažený soubor" type="text/javascript"></script><style type="text/css">.hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}</style>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    hljs.initHighlightingOnLoad();
    window.addEventListener('DOMContentLoaded', function(){
        document.querySelectorAll('.hl code').forEach((block) => {
            hljs.highlightBlock(block);
        });
        document.querySelectorAll('code.highlight-lines').forEach(function(b){
            hljs.lineNumbersBlock(b);
            if ((b.innerHTML.trim().match(/\r\n|\r|\n/g) || []).length > 0){
                b.parentElement.style = "padding-left: 0px !important;"
                b.classList.add('hljs');
            }
        });
    });
    // @license-end
    </script>
<style>
      :root {
        --cs-base-bg-color: #039bba;
        --cs-light-bg-color: #62d5ed;
        --cs-base-font-color: #fff;
        --cs-light-font-color: #000;
    }
    </style>
<style>
.cs_top_menu_item {
  font-size: 0.88rem;
}
div.dropdown {
  -moz-transform: translateY(-1px);
}
</style>
<script src="./Lab 6_ Multi-Part File Downloader_files/cs_ajax.js.stažený soubor" type="text/javascript"></script>
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body style="margin: 0px;">
<header id="cs_header">
<div class="nav-container">
<div class="cs_header_text"><a href="https://py.mit.edu/spring22"><img src="./Lab 6_ Multi-Part File Downloader_files/logo.gif">&nbsp;6.009</a></div>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_84494260bb2b4bc1ef74fe697ea810e0">Information<span class="downarrow">▼</span></label>
<input checked="false" class="dropdown-checkbox" id="cs_menu_84494260bb2b4bc1ef74fe697ea810e0" type="checkbox">
<div class="dropdown-content">
<a class="cs_top_menu_item" href="https://py.mit.edu/spring22/info/basics">Basic Information</a>
<a class="cs_top_menu_item" href="https://py.mit.edu/spring22/info/help">Getting Help</a>
<a class="cs_top_menu_item" href="https://py.mit.edu/spring22/info/grading">Grading Policies</a>
<a class="cs_top_menu_item" href="https://py.mit.edu/spring22/info/academic_integrity">Academic Integrity</a>
<a class="cs_top_menu_item" href="https://py.mit.edu/spring22/info/infrastructure">Infrastructure</a>
<a class="cs_top_menu_item" href="https://py.mit.edu/spring22/notes">Course Notes</a>
<a class="cs_top_menu_item" href="https://py.mit.edu/spring22/info/staff">Staff List</a></div></div>
<a class="cs_top_menu_item" href="https://py.mit.edu/spring22/queue/">Help Queue</a>
<a class="cs_top_menu_item" href="https://discourse6009.mit.edu/">Forum</a>
<a class="cs_top_menu_item" href="https://py.mit.edu/spring22/progress">Progress</a>
<a class="cs_top_menu_item" href="https://py.mit.edu/spring22/labs/lab06?loginaction=login">Log In</a><a class="icon" href="javascript:void(0);" onclick="toggleResponsiveHeader()">☰</a>
</div>
</header>
<div class="cs_navigation cs_top_navigation" id="cs_top_navigation"><span class="line"><a href="https://py.mit.edu/spring22">Home</a></span> <span class="cs_nav_separator">/</span> <span class="line"><a href="https://py.mit.edu/spring22/labs/lab06">Lab 6: Multi-Part File Downloader</a></span></div>
<main class="cs_body" id="cs_body">
<div class="cs_left_menu"></div>
<div class="cs_content">
<div class="cs_page_body">
<center><h1 class="cs_content_header">Lab 6: Multi-Part File Downloader</h1></center>
<div class="response" id="catsoop_login_box">
<b><center>You are not logged in.</center></b><br>
If you are a current student, please <a href="https://py.mit.edu/spring22/labs/lab06?loginaction=login">Log
In</a> for full access to the web site.<br>Note that this link will take you to
an external site (<tt>https://shimmer.mit.edu</tt>) to authenticate, and then you will be redirected
back to this page.
</div>
<h2>Table of Contents</h2><ul><li><a href="https://py.mit.edu/spring22/labs/lab06#_preparation">1) Preparation</a></li><li><a href="https://py.mit.edu/spring22/labs/lab06#_introduction">2) Introduction</a></li><ul><li><a href="https://py.mit.edu/spring22/labs/lab06#_downloads">2.1) Downloads</a></li><ul><li><a href="https://py.mit.edu/spring22/labs/lab06#_using_the_httpresponse_object">2.1.1) Using the HTTPResponse Object</a></li></ul><li><a href="https://py.mit.edu/spring22/labs/lab06#_file_manifests">2.2) File Manifests</a></li><ul><li><a href="https://py.mit.edu/spring22/labs/lab06#_caching">2.2.1) Caching</a></li><li><a href="https://py.mit.edu/spring22/labs/lab06#_example_manifest">2.2.2) Example Manifest</a></li></ul><li><a href="https://py.mit.edu/spring22/labs/lab06#_file_sequences">2.3) File Sequences</a></li></ul><li><a href="https://py.mit.edu/spring22/labs/lab06#_structure">3) Structure</a></li><ul><li><a href="https://py.mit.edu/spring22/labs/lab06#_basic_downloads">3.1) Basic Downloads</a></li><li><a href="https://py.mit.edu/spring22/labs/lab06#_handling_manifests">3.2) Handling Manifests</a></li><ul><li><a href="https://py.mit.edu/spring22/labs/lab06#_caching_2">3.2.1) Caching</a></li></ul><li><a href="https://py.mit.edu/spring22/labs/lab06#_handling_file_sequences">3.3) Handling File Sequences</a></li></ul><li><a href="https://py.mit.edu/spring22/labs/lab06#_interfaces">4) Interfaces</a></li><li><a href="https://py.mit.edu/spring22/labs/lab06#_implementation_advice">5) Implementation Advice</a></li><li><a href="https://py.mit.edu/spring22/labs/lab06#_test_files">6) Test Files</a></li><li><a href="https://py.mit.edu/spring22/labs/lab06#_other_errors">7) Other Errors</a></li><li><a href="https://py.mit.edu/spring22/labs/lab06#_code_submission">8) Code Submission</a></li><li><a href="https://py.mit.edu/spring22/labs/lab06#_checkoff">9) Checkoff</a></li><li><a href="https://py.mit.edu/spring22/labs/lab06#_optional_additional_extensions">10) (Optional) Additional Extensions</a></li><ul><li><a href="https://py.mit.edu/spring22/labs/lab06#_files_of_your_own">10.1) Files of Your Own</a></li><li><a href="https://py.mit.edu/spring22/labs/lab06#_parallel_downloads">10.2) Parallel Downloads</a></li><li><a href="https://py.mit.edu/spring22/labs/lab06#_avoiding_the_recursion_limit">10.3) Avoiding the Recursion Limit</a></li></ul></ul>
<a class="anchor" name="catsoop_section_1"></a><a class="anchor" name="_preparation"></a><h2 class="cs_section_title">1) Preparation<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_preparation">§</a></h2>
<p>The following file contains code and other resources as a starting point for
this lab: <a download="lab06.zip" href="https://py.mit.edu/spring22/lab_distribution.zip?path=%5B%22spring22%22%2C+%22labs%22%2C+%22lab06%22%5D"><tt>lab06.zip</tt></a></p>
<p>Most of your changes should be made to <code>lab.py</code>, which you will submit at the
end of this lab.  Importantly, you should not add any imports to the file.</p>
<p>You can also see and participate in online discussion about this lab in the <a href="https://py.mit.edu/forum/c/labs" target="_blank">"Labs"
Category</a> in the forum.</p>
<p>This lab is worth a total of 4 points.</p>
<p>Note that passing all of the tests on the server will require that your code
runs reasonably efficiently.</p>
<p><strong>The questions on this page (including your code submission) are due after the
spring break at 5pm Eastern on Friday, 1 April (no joke!).  The checkoff is due
after the spring break, at 10pm Eastern on Wednesday, 6 April.</strong></p>
<div class="callout callout-warning"><div class="callout-title">Your Checkoff This Week</div>
<p>You are not logged in.  Please log in to see information about your checkoff for this lab.</p>
</div>
<a class="anchor" name="catsoop_section_2"></a><a class="anchor" name="_introduction"></a><h2 class="cs_section_title">2) Introduction<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_introduction">§</a></h2>
<p>One way to handle the problem of reliably storing large files is to break them
into pieces that are placed on multiple disks, or on multiple machines.  This
way, if something goes wrong with a particular file (and/or with a particular
machine as a whole), the file is still available.</p>
<p>In this lab, you will build a <em>multi-part</em> downloader that assembles a data
stream from multiple parts streaming individually from multiple machines. It
allows the same part to be stored redundantly in multiple locations so it can
be resilient to failures.  Since the multipart streams you will be downloading
may be unbounded and never end, your program will assemble the stream
incrementally from its parts as they are downloaded, displaying the file or
streamed sequence of files (an animated sequence of images, for example) as the
download progresses.</p>
<p>This page describes the specification for the lab, but it also aims to provide
some review on a few aspects of Python that were discussed in lecture but that
have not been used explicitly in a lab yet.</p>
<p><strong>We suggest reading the entire lab before writing any code</strong>, to get a sense
of the program you are being asked to write.</p>
<p><a class="anchor" name="catsoop_section_2_1"></a><a class="anchor" name="_downloads"></a></p><h3 class="cs_section_title">2.1) Downloads<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_downloads">§</a></h3><p></p>
<p>Throughout this lab, we will be interested in downloading files from various
web servers.  We have provided a function called <code>http_response</code>, which is
defined in <code>http009.py</code>, to help you with this task.  <code>http_response</code> is a thin
wrapper around functionality from Python's built-in <a href="https://docs.python.org/3/library/http.client.html"><code>http.client</code> module</a>.</p>
<p>That function takes a single argument (a string representing the
<a href="https://en.wikipedia.org/wiki/URL">URL</a> of a resource we wish to look up), and
it returns an <a href="https://docs.python.org/3/library/http.client.html#httpresponse-objects"><code>HTTPResponse</code>
object</a>.</p>
<p>In particular, we are interested in three or four attributes/methods of these
objects.  If <code>r</code> is the result of calling <code>http_response</code>, then:</p>
<ul>
<li><code>r.status</code> gives the <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">HTTP status code</a> that the server returned.  There are many different status codes.  For this lab, though, we will need to know that <code>301</code>, <code>302</code>, and <code>307</code> represent redirects; that <code>404</code> means that the specified file was not found; that <code>500</code> means that an error occurred on the server; and that <code>200</code> corresponds to a successful request.</li>
<li><code>r.getheader(name)</code> returns the HTTP response header associated with the given name.  In the case of a redirect, <code>r.getheader('location')</code> will provide the location to which we were redirected.  In the case of a successful request, <code>r.getheader('content-type')</code> will tell you the <a href="https://en.wikipedia.org/wiki/Media_type">media type</a> of the response.</li>
<li><code>r.read(num_bytes)</code> returns a bytestring containing at most <code>num_bytes</code> number of bytes read from the body of the response.  If no more bytes can be read, returns an empty bytestring <code>b''</code>.  If <code>num_bytes</code> is not given, return the entire page contents.  <b>See <a href="https://py.mit.edu/spring22/labs/lab06/bytes">this page</a> if you are unfamiliar with Python bytestrings.</b></li>
<li><code>r.readline()</code> returns a bytestring containing the next line of the body of the response.  It returns an empty bytestring <code>b''</code> if no more bytes can be read.</li>
</ul>
<p><a class="anchor" name="catsoop_section_2_1_1"></a><a class="anchor" name="_using_the_httpresponse_object"></a></p><h4 class="cs_section_title">2.1.1) Using the HTTPResponse Object<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_using_the_httpresponse_object">§</a></h4><p></p>
<p>Try calling <code>http_response</code> from the Python REPL for a few different URLs, to
get a sense of how it behaves (you can get to a Python REPL with that function
defined by running <code>python3 -i http009.py</code>).</p>
<p>Inspect the objects returned from this function, and use this info to answer
the questions below.</p>
<div class="callout callout-error"><div class="callout-title">Note for Mac Users!</div>
<p>Some Mac users may encounter an issue along the lines of the following when using <code>http_response</code>:</p><pre><code class="nohighlight">ssl.SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1091)
</code></pre><p>If you are encountering this issue, you should be able to fix it by installing the <a href="https://pypi.org/project/certifi/"><code>certifi</code></a> package using <code>pip</code>:</p><pre><code class="nohighlight">pip install --upgrade --force-reinstall certifi
</code></pre>
</div>
<p>
<!--START question resp1 -->
</p><div class="question question-multiplechoice" id="cs_qdiv_resp1" style="position: static">
<div id="resp1_rendered_question">
Which of the following URLs return a redirect status code?<br>&nbsp;<br><table border="0">
<tbody><tr><td align="center"><input name="resp1_opt0" type="checkbox" value="0"></td><td><code>'https://py.mit.edu'</code></td></tr>
<tr><td align="center"><input name="resp1_opt1" type="checkbox" value="1"></td><td><code>'https://py.mit.edu/spring22/labs/lab11'</code></td></tr>
<tr><td align="center"><input name="resp1_opt2" type="checkbox" value="2"></td><td><code>'https://py.mit.edu/spring22/info/basics'</code></td></tr>
<tr><td align="center"><input name="resp1_opt3" type="checkbox" value="3"></td><td><code>'https://discourse6009.mit.edu/'</code></td></tr>
<tr><td align="center"><input name="resp1_opt4" type="checkbox" value="4"></td><td><code>'http://nonexistent.mit.edu/some_file.jpg'</code></td></tr>
</tbody></table><input id="resp1" name="resp1" type="hidden" value="{}">
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
var resp1_selected = {};
document.getElementById("resp1").value = JSON.stringify(resp1_selected);
document.querySelectorAll("input[type=checkbox][name^=resp1_opt]").forEach(function(r){
    r.addEventListener("click", function(){
        resp1_selected[this.getAttribute("name")] = this.checked;
    document.getElementById("resp1").value = JSON.stringify(resp1_selected);
    });
});
// @license-end
</script>
</div><div>
<span id="resp1_buttons"></span>
<span id="resp1_loading_wrapper">
<span id="resp1_loading" style="display:none;"><img src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="></span>
</span>
<span id="resp1_score_display"></span>
<div class="nsubmits_left" id="resp1_nsubmits_left"></div></div>
<div id="resp1_solution_container">
<div id="resp1_solution">
</div>
<div id="resp1_solution_explanation">
</div>
</div>
<div id="resp1_message"></div>
</div>
<!--END question resp1 -->
<!--START question resp2 -->
<div class="question question-pythonic" id="cs_qdiv_resp2" style="position: static">
<div id="resp2_rendered_question">
How many bytes are in the body returned by the following url:<br>&nbsp;<br>
<code>'https://py.mit.edu/spring22/info/basics'</code><br>&nbsp;<br><input id="resp2" name="resp2" size="70" type="text" value="">
</div><div>
<span id="resp2_buttons"></span>
<span id="resp2_loading_wrapper">
<span id="resp2_loading" style="display:none;"><img src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="></span>
</span>
<span id="resp2_score_display"></span>
<div class="nsubmits_left" id="resp2_nsubmits_left"></div></div>
<div id="resp2_solution_container">
<div id="resp2_solution">
</div>
<div id="resp2_solution_explanation">
</div>
</div>
<div id="resp2_message"></div>
</div>
<!--END question resp2 -->
<!--START question resp3 -->
<div class="question question-pythonic" id="cs_qdiv_resp3" style="position: static">
<div id="resp3_rendered_question">
What are the first 10 bytes returned from the following URL? Enter your answer as a python bytestring literal.<br>&nbsp;<br>
<code>'https://py.mit.edu/_static/spring22/logo.gif'</code><br>&nbsp;<br><input id="resp3" name="resp3" size="70" type="text" value="">
</div><div>
<span id="resp3_buttons"></span>
<span id="resp3_loading_wrapper">
<span id="resp3_loading" style="display:none;"><img src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="></span>
</span>
<span id="resp3_score_display"></span>
<div class="nsubmits_left" id="resp3_nsubmits_left"></div></div>
<div id="resp3_solution_container">
<div id="resp3_solution">
</div>
<div id="resp3_solution_explanation">
</div>
</div>
<div id="resp3_message"></div>
</div>
<!--END question resp3 -->
<p></p>
<p>
<!--START question q000000 -->
</p><div class="question question-pythonic" id="cs_qdiv_q000000" style="position: static">
<div id="q000000_rendered_question">
What is the status code if we make a request for the following URL?<br>&nbsp;<br>
<code>'http://py.mit.edu'</code><br>&nbsp;<br><input id="q000000" name="q000000" size="70" type="text" value="">
</div><div>
<span id="q000000_buttons"></span>
<span id="q000000_loading_wrapper">
<span id="q000000_loading" style="display:none;"><img src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="></span>
</span>
<span id="q000000_score_display"></span>
<div class="nsubmits_left" id="q000000_nsubmits_left"></div></div>
<div id="q000000_solution_container">
<div id="q000000_solution">
</div>
<div id="q000000_solution_explanation">
</div>
</div>
<div id="q000000_message"></div>
</div>
<!--END question q000000 -->
<p></p>
<p>
<!--START question resp5 -->
</p><div class="question question-pythonic" id="cs_qdiv_resp5" style="position: static">
<div id="resp5_rendered_question">
What is the <code>'location'</code> header associated with a request for the following URL?<br>&nbsp;<br>
<code>'http://py.mit.edu'</code><br>&nbsp;<br>
Enter your answer as a Python string:<br><input id="resp5" name="resp5" size="70" type="text" value="">
</div><div>
<span id="resp5_buttons"></span>
<span id="resp5_loading_wrapper">
<span id="resp5_loading" style="display:none;"><img src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="></span>
</span>
<span id="resp5_score_display"></span>
<div class="nsubmits_left" id="resp5_nsubmits_left"></div></div>
<div id="resp5_solution_container">
<div id="resp5_solution">
</div>
<div id="resp5_solution_explanation">
</div>
</div>
<div id="resp5_message"></div>
</div>
<!--END question resp5 -->
<p></p>
<p><a class="anchor" name="catsoop_section_2_2"></a><a class="anchor" name="_file_manifests"></a></p><h3 class="cs_section_title">2.2) File Manifests<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_file_manifests">§</a></h3><p></p>
<p>In addition to being able to download regular files, we include a definition of
a <em>file manifest</em>, which is a way of specifying how a particular file is broken
down into parts.  Your program can assume that a given URL represents a file
manifest if it ends with <code>.parts</code>, or if the <code>Content-Type</code> header associated
with the request is <code>text/parts-manifest</code>.</p>
<p>The manifest contains several parts, each of which is separated by a line
containing only two hyphens <code>--</code>.  For example, a file <code>picture.jpg</code> might be
broken down into three parts, which could be specified with:</p>
<pre><code class="nohighlight">http://mymachine.mit.edu/picture.jpg-part1
--
http://mymachine.mit.edu/picture.jpg-part2
--
http://mymachine.mit.edu/picture.jpg-part3
</code></pre>
<p>To download the contents of a file specified by a manifest, you would need to
download each of the individual parts, and then to concatenate them together to
determine the contents of the entire file.</p>
<p>In addition, the manifest can provide <em>alternatives</em> for each section (so that
a part may be redundantly stored in multiple locations):</p>
<pre><code class="nohighlight">http://mymachine.mit.edu/picture.jpg-part1
http://yourmachine.mit.edu/picture.jpg-part1
--
http://mymachine.mit.edu/picture.jpg-part2
http://yourmachine.mit.edu/picture.jpg-part2
--
http://mymachine.mit.edu/picture.jpg-part3
http://yourmachine.mit.edu/picture.jpg-part3
</code></pre>
<p>In this example, each of the three parts is stored both on <code>mymachine.mit.edu</code>
and on <code>yourmachine.mit.edu</code>.  For each part, if the first option is not
successfully downloaded, we should try the second option (and so on until we
find one that works).  In general, a manifest is not limited to 2 options;
there may be arbitrarily many options for each part, and each part might have a
different number of options.</p>
<p>Manifest streams can be recursive, which means that a part might itself be
specified by a URL ending in <code>.parts</code> (which represents a manifest stream).  In
the case where a part refers to a manifest stream, the entire contents of the
file referred to by that manifest stream should be used.</p>
<p>For example, if <code>http://mymachine.mit.edu/endless.txt.parts</code> contains the
following lines:</p>
<pre><code class="nohighlight">http://mymachine.mit.edu/verse.txt
http://yourmachine.mit.edu/verse.txt
http://hermachine.mit.edu/verse.txt
--
http://yourmachine.mit.edu/chorus.txt
--
http://mymachine.mit.edu/endless.txt.parts
</code></pre>
<p>Then someone downloading the file should receive an endless file alternating
between the contents of <code>verse.txt</code> and <code>chorus.txt</code>.</p>
<p><a class="anchor" name="catsoop_section_2_2_1"></a><a class="anchor" name="_caching"></a></p><h4 class="cs_section_title">2.2.1) Caching<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_caching">§</a></h4><p></p>
<p>Manifest files may have parts that are replicated multiple times in the same
file. This may be obvious from the previous manifest file, which is an endless
stream of two replicated text parts.  Thus, we will also add the capability to
cache parts of files within a single download (though we will explicitly <strong>not</strong>
cache these results across multiple downloads).</p>
<p>Note that caching is not a good idea if a file changes frequently (that is,
frequently enough that a part would be changed within a single download). To
handle this, we allow caching for a part only if <code>(*)</code> is listed as a possible
URL for that part in the manifest file. This indicates that the manifest file
deems a particular part to be largely fixed content, so it can be safely cached
within a single download.</p>
<p>When downloading, if we reach a part that is marked as cacheable, we should
first check to see if any of the URLs has been cached.  If so, we should simply
use that result (without making any HTTP requests).  If not, we should follow
the normal procedure, but we should also store the result in the cache before
continuing.  Importantly, caching should not interrupt the streaming (i.e., we
should still be able to stream from files as we download them, rather than
having to wait for the whole file to be downloaded first).</p>
<p>Parts in the manifest that are not marked with an <code>(*)</code> <strong>should never be
cached</strong>.  This requires that the content for these links should not be read
from the cache, or stored to the cache. Thus, a sample Manifest file that
supports caching could look like the following:</p>
<pre><code class="nohighlight">(*)
http://mymachine.mit.edu/verse.txt
http://yourmachine.mit.edu/verse.txt
http://hermachine.mit.edu/verse.txt
--
http://yourmachine.mit.edu/chorus.txt
(*)
--
http://mymachine.mit.edu/endless.txt.parts
</code></pre>
<p>For simplicitly, it is not necessary to support caching manifest files
themselves, and <strong>it is not necessary to support caching infinite files</strong>
(i.e., you can assume that any file you are being asked to cache is finite in
length).</p>
<p><a class="anchor" name="catsoop_section_2_2_2"></a><a class="anchor" name="_example_manifest"></a></p><h4 class="cs_section_title">2.2.2) Example Manifest<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_example_manifest">§</a></h4><p></p>
<p><a class="anchor" name="catsoop_section_2_3"></a><a class="anchor" name="_file_sequences"></a></p><h3 class="cs_section_title">2.3) File Sequences<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_file_sequences">§</a></h3><p></p>
<p>In addition to manifests, we would also like to handle <em>file sequences</em>.  In
general, a file sequence is a single stream of bits that represents a sequence
of multiple files.  We'll use a format of our own invention, but it's not too
different from, for example, a movie file (which can be thought of as a
sequence of frames, each of which is an image).</p>
<p>If a URL contains the string <code>-seq</code>, the resulting stream represents a sequence
of files.  Each sub-file in a sequence is represented as:</p>
<ul>
<li>4 bytes containing the length of the file (in bytes, represented as a single
big-endian unsigned integer (see <a href="https://py.mit.edu/spring22/labs/lab06/bytes#_representing_integers_with_bytestrings">section 4 of the binary data reference page</a>), followed
by</li>
<li>the raw bytes contained in the file (there should be as many bytes as were
specified in the length field).</li>
</ul>
<p>As an example, consider a file consisting of the following 5 bytes (shown in
<a href="https://en.wikipedia.org/wiki/Hexadecimal">hexadecimal</a>):</p>
<pre><code class="nohighlight">36 2E 30 30 39
</code></pre>
<p>and another file consisting of the following 6 bytes:</p>
<pre><code class="nohighlight">72 75 6C 65 73 21
</code></pre>
<p>We could encode a <em>file sequence</em> consisting of these two files with the following
stream of 19 bytes (4-byte length + 5-byte file + 4-byte length + 6-byte file):</p>
<pre><code class="nohighlight">00 00 00 05 36 2E 30 30 39 00 00 00 06 72 75 6C 65 73 21
</code></pre>
<p>If a URL contains <code>-seq</code> and is also a manifest (the URL ends with <code>.parts</code> or
the content type is <code>text/parts-manifest</code>), then it represents a manifest file
that, when all parts are concatenated, represents a file sequence.</p>
<p>
<!--START question fileseq1 -->
</p><div class="question question-pythonic" id="cs_qdiv_fileseq1" style="position: static">
<div id="fileseq1_rendered_question">
<p>Suppose a file sequence has the following bytestring body. How many bytes are in the third file?</p>
<pre><code class="nohighlight">b'\x00\x00\x00\x09\x44\x65\x62\x75\x67\x67\x69\x6E\x67\x00\x00\x00\x02\x69\x73\x00\x00\x00\x04\x68\x61\x72\x64\x00\x00\x00\x03\x62\x75\x74\x00\x00\x00\x04\x66\x75\x6E\x21'
</code></pre>
<input id="fileseq1" name="fileseq1" size="50" type="text" value="">
</div><div>
<span id="fileseq1_buttons"></span>
<span id="fileseq1_loading_wrapper">
<span id="fileseq1_loading" style="display:none;"><img src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="></span>
</span>
<span id="fileseq1_score_display"></span>
<div class="nsubmits_left" id="fileseq1_nsubmits_left"></div></div>
<div id="fileseq1_solution_container">
<div id="fileseq1_solution">
</div>
<div id="fileseq1_solution_explanation">
</div>
</div>
<div id="fileseq1_message"></div>
</div>
<!--END question fileseq1 -->
<p></p>
<a class="anchor" name="catsoop_section_3"></a><a class="anchor" name="_structure"></a><h2 class="cs_section_title">3) Structure<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_structure">§</a></h2>
<p>We have provided a very small skeleton in <code>lab.py</code>, indicating the functions
that must be defined for this lab.  Beyond those, you are welcome to define
whatever helper functions / classes you deem necessary.</p>
<p><a class="anchor" name="catsoop_section_3_1"></a><a class="anchor" name="_basic_downloads"></a></p><h3 class="cs_section_title">3.1) Basic Downloads<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_basic_downloads">§</a></h3><p></p>
<p>We'll start by discussing basic downloads.  You should fill in the body of the
<code>download_file</code> function to implement a basic "streaming" downloader.
"Streaming" refers to the fact that we want to provide bytes from the file as
they are being received, rather than downloading the entire file first and then
returning its contents.  This style of download makes sense in a lot of
contexts, most notably in situations where we want to download a large file but
not need to wait until the whole download has finished in order to make use of
some of it (for example, streaming audio and video applications).</p>
<p><code>download_file</code> should be a generator that yields the result of the response as
bytestrings of at most <code>chunk_size</code> length (it should yield bytestrings of this
size until it is no longer able to do so, at which point it should yield one
bytestring of smaller size if the file contains additional content).</p>
<p>Note that, thoughout this lab, we will assume that any URL refers to a
potentially infinite stream (for example, a stream from a webcam).  As such,
your <code>download_file</code> function <strong>should not download the entire contents of the
file and yield values from that result; rather, it should yield chunks of the
file as they are downloaded.</strong></p>
<p>We will also assume that any URL refers to arbitrary binary data (it could be
an image, or text, or random bytes, etc).  Aside from checking whether the URL
refers to a file manifest, your code should not need to change its behavior
based on the type of the data (or the <code>content-type</code> header).</p>
<p>There are a couple of additional complications.  If a request results in a
redirect (status codes <code>301</code>, <code>302</code>, or <code>307</code> for our purposes), your
downloader should follow that redirect and try the location to which you are
being redirected.  If a request gives a <code>404</code> status code, your downloader
should raise an <code>HTTPFileNotFoundError</code>.  If a request gives a <code>500</code> status code, or
if the connection was not made because of a network error, your downloader
should raise an <code>HTTPRuntimeError</code>.  A status code of <code>200</code> indicates a successful
request.</p>
<p>Note that you can raise exceptions using Python's <code>raise</code> keyword, and you can
also specify an associated wrror message if you wish, for example:</p>
<pre><code class="language-python hljs"><span class="hljs-keyword">raise</span> ValueError()
</code></pre>
<pre><code class="language-python hljs"><span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">'here is an error message'</span>)
</code></pre>
<p><a class="anchor" name="catsoop_section_3_2"></a><a class="anchor" name="_handling_manifests"></a></p><h3 class="cs_section_title">3.2) Handling Manifests<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_handling_manifests">§</a></h3><p></p>
<p>If the location given at initialization time ends with <code>.parts</code> <strong>or</strong> if the
<code>content-type</code> header associated with a request is <code>'text/parts-manifest'</code>,
then it represents a file manifest.  In this case, rather than simply yielding
the contents of that <code>.parts</code> file, <code>download_file</code> should instead yield the
bytes from each of the files specified in the manifest, in the order they are
specified.</p>
<p>In order to keep things as smooth as possible, your function should start
streaming the first part as soon as it is available, rather than waiting for
all parts to be available before streaming.</p>
<p><a class="anchor" name="catsoop_section_3_2_1"></a><a class="anchor" name="_caching_2"></a></p><h4 class="cs_section_title">3.2.1) Caching<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_caching_2">§</a></h4><p></p>
<p>You should also make sure that your program properly caches files that were
indicated with <code>(*)</code> in any file manifests that were given (so that, if we have
already retrieved their contents once in the process of downloading the file,
we do not do so a second time).  Your program should not cache other files.</p>
<p>If a file is cached, it is OK to yield the entire contents of the cached file
as one bytestring (rather than splitting it up into chunks and yielding those
separately).</p>
<p>Importantly, the cache should not persist between calls to <code>download_file</code>.
That is, starred files that we try to download multiple times <em>within a single
top-level call to <code>download_file</code></em> should be cached, but that cache should be
invalidated with every new top-level call to <code>download_file</code>.</p>
<p><a class="anchor" name="catsoop_section_3_3"></a><a class="anchor" name="_handling_file_sequences"></a></p><h3 class="cs_section_title">3.3) Handling File Sequences<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_handling_file_sequences">§</a></h3><p></p>
<p>The description above should be enough for <em>downloading</em> file sequences, but it
is not yet enough for interpreting them.  You should not need to change any
behavior in your downloader to account for file sequences.  But the GUI needs
to know something about how to handle file sequences in order to properly
display them, so we'll add a small piece of functionality to allow us to grab
individual files from the sequence.</p>
<p>Write a new generator called <code>files_from_sequence(stream)</code>.  Given a generator
of the form described for <code>download_file</code>, <code>files_from_sequence</code> should yield
the contents of each file contained in the sequence, in the order they are
specified.  Note that each of the chunks yielded from <code>download_file</code> might
contain multiple files, or it might not contain an entire file.  Your function
will need to account for both of these cases.</p>
<a class="anchor" name="catsoop_section_4"></a><a class="anchor" name="_interfaces"></a><h2 class="cs_section_title">4) Interfaces<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_interfaces">§</a></h2>
<p>We would like to provide two interfaces to the programs we have just written.
We have already provided one such interface (for displaying downloaded images
and/or text files) for you in <code>gui.py</code> in the lab distribution.</p>
<p>You can run the GUI from the command line by giving it a URL as argument:</p>
<pre><code class="nohighlight">$ python3 gui.py URL
</code></pre>
<p>The GUI will then use your code to stream the file, and it will attempt to
display it.  You can also optionally specify an additional integer argument
that specifies how long the GUI should wait between switching files in a file
sequence when displaying them (this value is specified in milliseconds).</p>
<p>In addition, we would like to provide an interface for saving the results of
downloading a file and saving its contents to disk.</p>
<p>Modify your <code>lab.py</code> so that it takes two arguments when it is run from the
command line:</p>
<pre><code class="nohighlight">$ python3 lab.py URL FILENAME
</code></pre>
<p>When invoked in this way, your program should download a file from <code>URL</code>, and
save its contents at a location given by <code>FILENAME</code>.  If the given URL refers
to a parts manifest, you should not directly save the contents of the manifest;
rather, you should save the contents of the file to which that manifest refers.
If the given URL refers to a sequence, then instead of saving a single file,
you should save multiple files of the form <code>FILENAME-file1</code>, <code>FILENAME-file2</code>, ...;
each of these files should contain one file from the sequence.</p>
<p>From inside of Python, these arguments are available as part of the <code>sys.argv</code>
list (note that, if you haven't already, you should add <code>import sys</code> near the
top of your file at this point).  For the example above, <code>sys.argv</code> will
contain:</p>
<pre><code class="nohighlight">['lab.py', 'URL', 'FILENAME']
</code></pre>
<p>Note that you can open a file for writing binary data with <code>open(filename, 'wb')</code>
and you can write data to the file by calling the <code>write</code> method of the
resulting file-like object.</p>
<a class="anchor" name="catsoop_section_5"></a><a class="anchor" name="_implementation_advice"></a><h2 class="cs_section_title">5) Implementation Advice<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_implementation_advice">§</a></h2>
<p>This is a fairly complicated task, and so trying to write it all in one go
might make the task of organizing your code (and of debugging) more difficult.
You may find it easier to implement the lab in small pieces first.  For
example, you might:</p>
<ul>
<li>start by writing something that downloads a single file that you know exists (after which <code>test_streaming</code> should pass), then</li>
<li>add the command line interface for downloading a file, then</li>
<li>introduce support for handling redirects and/or errors (after which <code>test_behaviors</code> should pass), then</li>
<li>add support for handling file manifests (after which <code>test_manifest</code> should pass), then</li>
<li>add support for caching (after which <code>test_cache</code> should pass), then</li>
<li>add support for file streams (after which all tests should pass).</li>
</ul>
<p>You might find a different order preferable, but starting small and then adding
functionality piece by piece is likely to make the debugging process more
straightforward.</p>
<a class="anchor" name="catsoop_section_6"></a><a class="anchor" name="_test_files"></a><h2 class="cs_section_title">6) Test Files<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_test_files">§</a></h2>
<p>The files below provide some data for testing (roughly in order of increasing complexity):</p>
<ul>
<li><a href="./Lab 6_ Multi-Part File Downloader_files/logo.gif" target="_blank"><tt>https://py.mit.edu/_static/spring22/logo.gif</tt></a> (single image)</li>
<li><a href="http://hz.mit.edu/009_lab6/bird.jpg" target="_blank"><tt>http://hz.mit.edu/009_lab6/bird.jpg</tt></a> (single image, with single redirect)</li>
<li><a href="http://scripts.mit.edu/~6.009/lab6/redir.py/0/wug.jpg" target="_blank"><tt>http://scripts.mit.edu/~6.009/lab6/redir.py/0/wug.jpg</tt></a> (single image, with many redirects)</li>
<li><a href="http://mit.edu/6.009/www/lab6_examples/yellowsub.txt.parts" target="_blank"><tt>http://mit.edu/6.009/www/lab6_examples/yellowsub.txt.parts</tt></a> (manifest file representing a piece of text)</li>
<li><a href="http://mit.edu/6.009/www/lab6_examples/fugue.wav.parts" target="_blank"><tt>http://mit.edu/6.009/www/lab6_examples/fugue.wav.parts</tt></a> (manifest file representing a piece of music)</li>
<li><a href="http://mit.edu/6.009/www/lab6_examples/cornsnake.jpg.parts" target="_blank"><tt>http://mit.edu/6.009/www/lab6_examples/cornsnake.jpg.parts</tt></a> (manifest file representing an image, with pieces spread across multiple machines)</li>
<li><a href="http://mit.edu/6.009/www/lab6_examples/cached_yellowsub.txt.parts" target="_blank"><tt>http://mit.edu/6.009/www/lab6_examples/cached_yellowsub.txt.parts</tt></a> (same as <code>yellowsub.txt.parts</code>, but with caching)</li>
<li><a href="http://mit.edu/6.009/www/lab6_examples/kafka.txt-seq" target="_blank"><tt>http://mit.edu/6.009/www/lab6_examples/kafka.txt-seq</tt></a> (sequence of many small files, best viewed in GUI)</li>
<li><a href="http://scripts.mit.edu/~6.009/lab6/fly.py/fly.txt-seq" target="_blank"><tt>http://scripts.mit.edu/~6.009/lab6/fly.py/fly.txt-seq</tt></a> (infinitely long sequence)</li>
<li><a href="http://scripts.mit.edu/~6.009/lab6/redir.py/0/smallcat.png-seq" target="_blank"><tt>http://scripts.mit.edu/~6.009/lab6/redir.py/0/smallcat.png-seq</tt></a> (sequence of images representing a short film, many redirects)</li>
<li><a href="http://scripts.mit.edu/~6.009/lab6/cats.png-seq.py" target="_blank"><tt>http://scripts.mit.edu/~6.009/lab6/cats.png-seq.py</tt></a> (infinitely long manifest of an animation, with simulation of a slow connection)</li>
<li><a href="http://scripts.mit.edu/~6.009/lab6/cats.png-seq.cached.py" target="_blank"><tt>http://scripts.mit.edu/~6.009/lab6/cats.png-seq.cached.py</tt></a> (like the above, but with caching)</li>
<li><a href="http://mit.edu/6.009/www/lab6_examples/skeletons.png-seq.parts" target="_blank"><tt>http://mit.edu/6.009/www/lab6_examples/skeletons.png-seq.parts</tt></a> (recursive manifest, sequence representing an infinitely looping animation)</li>
<li><a href="http://mit.edu/6.009/www/lab6_examples/skeletons.cached.png-seq.parts" target="_blank"><tt>http://mit.edu/6.009/www/lab6_examples/skeletons.cached.png-seq.parts</tt></a> (like the above, but with caching)</li>
</ul>
<p>
<!--START question file1 -->
</p><div class="question question-fileupload" id="cs_qdiv_file1" style="position: static">
<div id="file1_rendered_question">
Use your downloader to download the file represented by <code>http://mit.edu/6.009/www/lab6_examples/cornsnake.jpg.parts</code>.  This corresponds to an image, which you can view in an image editor of your choice.  Take a look, and then upload the resulting file below:<br><input id="file1" name="file1" style="display: none" type="file"><button class="btn btn-catsoop" id="file1_select_button">Select File</button>&nbsp;<tt><span id="file1_selected_file">No file selected</span></tt><script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
document.getElementById('file1_select_button').addEventListener('click', function (){
    document.getElementById("file1").click();
});
document.getElementById('file1').onchange = function (){
    document.getElementById('file1_selected_file').innerText = document.getElementById('file1').value;
};
dnd_file1 = document.getElementById('cs_qdiv_file1');
dnd_file1.ondragover = dnd_file1.ondragenter = function(e){e.preventDefault();};
dnd_file1.ondrop = function(e){
    document.getElementById("file1").files = e.dataTransfer.files;
    document.getElementById('file1').onchange();
    e.preventDefault();
};
// @license-end</script>
</div><div>
<span id="file1_buttons"></span>
<span id="file1_loading_wrapper">
<span id="file1_loading" style="display:none;"><img src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="></span>
</span>
<span id="file1_score_display"></span>
<div class="nsubmits_left" id="file1_nsubmits_left"></div></div>
<div id="file1_solution_container">
<div id="file1_solution">
</div>
<div id="file1_solution_explanation">
</div>
</div>
<div id="file1_message"></div>
</div>
<!--END question file1 -->
<p></p>
<p>
<!--START question file2 -->
</p><div class="question question-fileupload" id="cs_qdiv_file2" style="position: static">
<div id="file2_rendered_question">
Use your downloader to download the animation at <code>http://scripts.mit.edu/~6.009/lab6/redir.py/0/smallcat.png-seq</code>.  Upload the 53rd PNG file in the resulting file sequence:<br><input id="file2" name="file2" style="display: none" type="file"><button class="btn btn-catsoop" id="file2_select_button">Select File</button>&nbsp;<tt><span id="file2_selected_file">No file selected</span></tt><script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
document.getElementById('file2_select_button').addEventListener('click', function (){
    document.getElementById("file2").click();
});
document.getElementById('file2').onchange = function (){
    document.getElementById('file2_selected_file').innerText = document.getElementById('file2').value;
};
dnd_file2 = document.getElementById('cs_qdiv_file2');
dnd_file2.ondragover = dnd_file2.ondragenter = function(e){e.preventDefault();};
dnd_file2.ondrop = function(e){
    document.getElementById("file2").files = e.dataTransfer.files;
    document.getElementById('file2').onchange();
    e.preventDefault();
};
// @license-end</script>
</div><div>
<span id="file2_buttons"></span>
<span id="file2_loading_wrapper">
<span id="file2_loading" style="display:none;"><img src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="></span>
</span>
<span id="file2_score_display"></span>
<div class="nsubmits_left" id="file2_nsubmits_left"></div></div>
<div id="file2_solution_container">
<div id="file2_solution">
</div>
<div id="file2_solution_explanation">
</div>
</div>
<div id="file2_message"></div>
</div>
<!--END question file2 -->
<p></p>
<a class="anchor" name="catsoop_section_7"></a><a class="anchor" name="_other_errors"></a><h2 class="cs_section_title">7) Other Errors<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_other_errors">§</a></h2>
<p>What we have built in this lab is a fairly realistic system that interacts with
other computers via the Internet.  In such systems, there is the potential for
unforeseen errors to arise.  When using this system, a variety of errors could
happen that the description above has not explicitly accounted for.</p>
<p>Think through a few possible kinds of errors that could occur, but that aren't
explicitly described above, and modify your code so that it handles them.  In
particular, we want to think about kinds of inputs (valid or invalid) that
could break the either of the functions we've implemented above
(<code>download_file</code> and <code>files_from_sequence</code>), and adjust the code to account for
these errors.  <strong>You should be prepared to discuss this during your checkoff
conversation.</strong></p>
<a class="anchor" name="catsoop_section_8"></a><a class="anchor" name="_code_submission"></a><h2 class="cs_section_title">8) Code Submission<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_code_submission">§</a></h2>
<p>When you have tested your code sufficiently on your own machine, submit your
modified <code>lab.py</code> using the <code>submit-009-lab</code> script.  The following command
should submit the lab, assuming that the last argument <code>/path/to/lab.py</code> is
replaced by the location of your <code>lab.py</code> file:</p>
<pre><code class="language-nohighlight">$ submit-009-lab -a lab06 /path/to/lab.py
</code></pre>
<p>Running that script should submit your file to be checked, and it should also
provide some information about how and where to get feedback about your
submission.  Reloading this page after submitting will also show some
additional information:</p>
<div class="callout callout-note">You have not yet made any submissions to this assignment.</div>
<a class="anchor" name="catsoop_section_9"></a><a class="anchor" name="_checkoff"></a><h2 class="cs_section_title">9) Checkoff<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_checkoff">§</a></h2>
<p>Once you are finished with the code, please come to office hours
and add yourself to the queue asking for a checkoff.  <strong>You must be
ready to discuss your code and test cases in detail before asking for a checkoff.</strong></p>
<p>You should be prepared to demonstrate your code (which should be
well-commented, should avoid repetition, and should make good use of helper
functions).  In particular:</p>
<ul>
<li>Briefly describe the high-level design of your code for parsing manifest files.  How do you handle the case of potentially-infinite files?  Recursive manifests?</li>
<li>Briefly describe the high-level design of your implementation of caching, including how you made the cache persist within a single top-level call to <code>download_file</code> but not across multiple calls.</li>
<li>Briefly describe the high-level design of your code for parsing file sequences into their constituent files.  How does your code handle the fact that we don't have the complete file sequence available to work with?</li>
<li>Use the GUI to watch the animation represented by <a href="http://mit.edu/6.009/www/lab6_examples/skeletons.cached.png-seq.parts" target="_blank"><tt>http://mit.edu/6.009/www/lab6_examples/skeletons.cached.png-seq.parts</tt></a>.  This animation loops indefinitely, but there is a difference in all loops after the first one.  Why is this?</li>
<li>Section 7 asks you to consider other errors that might occur, beyond what the lab currently specifies or what <code>test.py</code> tests for.  Briefly describe some of the errors you thought about, as well as how you accounted for those possible errors in your code.</li>
</ul>
<div class="response"><i>You have not yet received this checkoff.</i></div>
<a class="anchor" name="catsoop_section_10"></a><a class="anchor" name="_optional_additional_extensions"></a><h2 class="cs_section_title">10) (Optional) Additional Extensions<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_optional_additional_extensions">§</a></h2>
<p><a class="anchor" name="catsoop_section_10_1"></a><a class="anchor" name="_files_of_your_own"></a></p><h3 class="cs_section_title">10.1) Files of Your Own<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_files_of_your_own">§</a></h3><p></p>
<p>It would be cool to use your downloader on some files of your own.  Try making
some files:</p>
<ul>
<li>an image or audio file of at least 100kB</li>
<li>an image or text file of at least 100kB, split into at least 3 distinct pieces and represented as a <code>.parts</code> file</li>
<li>a file sequence of at least 100kB, consisting of at least 3 distinct files</li>
</ul>
<p>Note that you can make a file accessible at <code>http://mit.edu/YOUR_ATHENA_USERNAME/www/FILENAME</code> by creating
a file called <code>FILENAME</code> in your Athena account under the <code>www</code> directory.  You
can use this to put your files on the web so that your downloader can reach
them.  See <a href="http://kb.mit.edu/confluence/pages/viewpage.action?pageId=3907182">this page from IST</a> for information about how to transfer files to your Athena account.</p>
<p>Then try downloading these files.</p>
<p><a class="anchor" name="catsoop_section_10_2"></a><a class="anchor" name="_parallel_downloads"></a></p><h3 class="cs_section_title">10.2) Parallel Downloads<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_parallel_downloads">§</a></h3><p></p>
<p>So far, our focus has been on the increased <em>reliability</em> that can come from
distrtibuting files across multiple parts/machines.  It turns out that doing
this can also be used to increase download <em>speeds</em>.  The basic idea is that a
way to download a file more quickly is to break it into parts, and to download
the different parts from different machines<a class="anchor" name="catsoop_footnote_ref_1"></a><a href="https://py.mit.edu/spring22/labs/lab06#catsoop_footnote_1"><sup>1</sup></a>.  By downloading files in
multiple small parts, the chance of the entire download failing is reduced; by
downloading those parts in parallel, we can often achieve faster download
speeds; and load is spread more evenly across the network.  As such, it is
often faster to download files in this way, compared to downloading the entire
file as one piece.</p>
<p>One nice extension for this lab would be modifying your code so that, when it
encounters a manifest file, it downloads all of the pieces in parallel (rather
than sequentially).</p>
<p><a class="anchor" name="catsoop_section_10_3"></a><a class="anchor" name="_avoiding_the_recursion_limit"></a></p><h3 class="cs_section_title">10.3) Avoiding the Recursion Limit<a class="cs_permalink" href="https://py.mit.edu/spring22/labs/lab06#_avoiding_the_recursion_limit">§</a></h3><p></p>
<p>At this point, a fairly common solution to the lab will not be able to play the
stream in <code>skeleton.png-seq.parts</code> indefinitely, as it will typically error out
due to hitting Python's recursion limit.  If your program has this issue, try
to find a way to fix it!</p>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
catsoop.all_questions = ['resp1', 'resp2', 'resp3', 'q000000', 'resp5', 'fileseq1', 'file1', 'file2'];
catsoop.username = null;
catsoop.this_path = 'https://py.mit.edu/spring22/labs/lab06';
catsoop.path_info = ['spring22', 'labs', 'lab06'];
catsoop.course = 'spring22';
catsoop.url_root = 'https://py.mit.edu';
catsoop.imp = '';
catsoop.skip_alert = [];
catsoop.viewans_confirm = "Are you sure?  Viewing the answer will prevent any further submissions to this question.  Press 'OK' to view the answer, or press 'Cancel' if you have changed your mind.";

// @license-end</script>
<br>&nbsp;<hr><b name="cs_footnotes">Footnotes</b><p><a class="anchor" name="catsoop_footnote_1"></a><sup style="padding-right:0.25em;color:var(--cs-base-bg-color);">1</sup>You may be familiar with
the peer-to-peer file sharing protocol BitTorrent, which uses this idea.  It is
also used in a variety of other contexts. <a href="https://py.mit.edu/spring22/labs/lab06#catsoop_footnote_ref_1"><span class="noprint">(click to return to text)</span></a></p>
</div>
</div>
<div class="cs_right_menu"></div>
</main>
<footer>
<div class="cs_navigation cs_bottom_navigation" id="cs_bottom_navigation"><span class="line"><a href="https://py.mit.edu/spring22">Home</a></span> <span class="cs_nav_separator">/</span> <span class="line"><a href="https://py.mit.edu/spring22/labs/lab06">Lab 6: Multi-Part File Downloader</a></span></div>
<div class="cs_footer">
      This page was last updated on Friday April 01, 2022 at 08:00:20 AM (revision <code>91e0aa47f</code>).<br>&nbsp;<br>
<pre class="catsooplogo" style="font-size:50%;">\            
/    /\__/\  
\__=(  o_O )=
(__________) 
 |_ |_ |_ |_ </pre>
      Powered by <a href="https://catsoop.mit.edu/" target="_blank">CAT-SOOP</a> v2022.2.0.dev19 "Highlander" (development snapshot).<br>
      CAT-SOOP is <a href="https://www.fsf.org/about/what-is-free-software" target="_blank">Free/Libre Software</a>, available under the terms<br>of the <a href="https://py.mit.edu/_util/license" target="_blank">GNU Affero General Public License, version 3</a>.<br>
<a download="" href="https://py.mit.edu/_util/source.zip" target="_blank">Download Source Code</a><br>
<a href="https://py.mit.edu/_util/jslicense.html" rel="jslicense" target="_blank">Javascript License Information</a>
</div>
</footer>



</body></html>